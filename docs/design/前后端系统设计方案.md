# å‰åç«¯ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€æŠ€æœ¯æ–¹æ¡ˆæ¨è

### åç«¯æ¡†æ¶é€‰æ‹©

**æ¨èï¼šFastAPI** â­â­â­â­â­
- **ä¼˜åŠ¿**ï¼š
  - æ€§èƒ½ä¼˜ç§€ï¼ˆåŸºäºStarletteå’ŒPydanticï¼‰
  - è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ï¼ˆSwagger UIï¼‰
  - ç±»å‹æç¤ºå’ŒéªŒè¯
  - å¼‚æ­¥æ”¯æŒ
  - è½»é‡çº§ï¼Œæ˜“äºéƒ¨ç½²
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼šFlaskï¼ˆæ›´ç®€å•ä½†æ€§èƒ½ç•¥ä½ï¼‰

### æ•°æ®å­˜å‚¨æ–¹æ¡ˆ

**æ¨èï¼šSQLite + JSONæ–‡ä»¶æ··åˆ**
- SQLiteï¼šå­˜å‚¨ç­”æ¡ˆåº“ï¼ˆä¾¿äºæœç´¢å’Œç´¢å¼•ï¼‰
- JSONæ–‡ä»¶ï¼šå¤‡ä»½å’Œå¯¼å…¥å¯¼å‡º
- ä¼˜ç‚¹ï¼šæ— éœ€é¢å¤–æ•°æ®åº“æœåŠ¡ï¼Œéƒ¨ç½²ç®€å•

### éƒ¨ç½²æ–¹æ¡ˆ

**å¼€å‘ç¯å¢ƒ**ï¼š
- æœ¬åœ°è¿è¡Œï¼š`uvicorn main:app --reload`
- ç«¯å£ï¼š8000ï¼ˆå¯é…ç½®ï¼‰

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
- ä½¿ç”¨Gunicorn + Uvicorn
- æˆ–ä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²
- å¯é…åˆNginxåå‘ä»£ç†

---

## äºŒã€APIè®¾è®¡

### 1. æœç´¢ç­”æ¡ˆæ¥å£

**æ¥å£ï¼š`POST /api/search`**

**è¯·æ±‚æ ¼å¼ï¼š**
```json
{
  "questionId": "5ae2df26223742f083202749dcb7769a",  // å¯é€‰ï¼Œç²¾ç¡®åŒ¹é…
  "questionContent": "ä¸‹åˆ—é€‰é¡¹ä¸­ï¼Œå¯¹äºåˆ›å»ºMavené¡¹ç›®...",  // é¢˜ç›®å†…å®¹
  "type": "0",  // é¢˜ç›®ç±»å‹ï¼š0=å•é€‰, 1=å¤šé€‰, 2=åˆ¤æ–­, 3=å¡«ç©º, 4=ç®€ç­”
  "options": [  // é€‰é¡¹åˆ—è¡¨ï¼ˆå¯é€‰ï¼Œä»…é€‰æ‹©é¢˜ï¼‰
    "Aã€Groupä¸ºé¡¹ç›®çš„ç»„å...",
    "Bã€Artifactä¸ºé¡¹ç›®çš„åç§°...",
    "Cã€Artifactä¸ºæ‰€åˆ›å»ºé¡¹ç›®åœ¨æœ¬åœ°å­˜æ”¾çš„è·¯å¾„",
    "Dã€Groupå’ŒArtifactæ˜¯MavenåŒºåˆ†é¡¹ç›®åŒ…çš„å­—æ®µ"
  ]
}
```

**å“åº”æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "answer": "C",  // ç­”æ¡ˆ
    "solution": "è§£æè¯´æ˜",  // è§£æï¼ˆå¦‚æœ‰ï¼‰
    "confidence": 0.95,  // åŒ¹é…ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
    "matchType": "exact",  // åŒ¹é…ç±»å‹ï¼šexact(ç²¾ç¡®), fuzzy(æ¨¡ç³Š), similar(ç›¸ä¼¼)
    "questionId": "5ae2df26223742f083202749dcb7769a"
  },
  "message": "æ‰¾åˆ°ç­”æ¡ˆ"
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
  "success": false,
  "data": null,
  "message": "æœªæ‰¾åˆ°åŒ¹é…çš„ç­”æ¡ˆ"
}
```

### 2. æ‰¹é‡æœç´¢æ¥å£

**æ¥å£ï¼š`POST /api/search/batch`**

**è¯·æ±‚æ ¼å¼ï¼š**
```json
{
  "questions": [
    {
      "questionId": "...",
      "questionContent": "...",
      "type": "0",
      "options": [...]
    },
    // ... æ›´å¤šé¢˜ç›®
  ]
}
```

**å“åº”æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": [
    {
      "questionId": "...",
      "answer": "C",
      "solution": "...",
      "confidence": 0.95
    },
    // ... æ›´å¤šç»“æœ
  ],
  "statistics": {
    "total": 10,
    "found": 8,
    "notFound": 2
  }
}
```

### 3. ä¸Šä¼ é¢˜åº“æ¥å£

**æ¥å£ï¼š`POST /api/upload`**

**è¯·æ±‚æ ¼å¼ï¼š**
```json
{
  "data": {  // data.jsonæ ¼å¼
    "resultObject": {
      "danxuan": { "lists": [...] },
      "duoxuan": { "lists": [...] },
      // ...
    }
  },
  "res": {  // res.jsonæ ¼å¼ï¼ˆå·²ç­”é¢˜ï¼‰
    "resultObject": {
      "danxuan": { "lists": [...] },
      // ...
    }
  },
  "answerRecords": [  // ç­”é¢˜è®°å½•
    {
      "id": "...",
      "questionId": "...",
      "type": "0",
      "questionContent": "...",
      "answer": "C",
      "timestamp": 1764324391661
    }
  ]
}
```

**å“åº”æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "updated": 150,  // æ›´æ–°çš„é¢˜ç›®æ•°é‡
    "new": 20,  // æ–°å¢çš„é¢˜ç›®æ•°é‡
    "total": 170,  // ç­”æ¡ˆåº“æ€»é¢˜ç›®æ•°
    "statistics": {
      "danxuan": 50,
      "duoxuan": 30,
      "panduan": 40,
      "tiankong": 30,
      "jianda": 20
    }
  },
  "message": "é¢˜åº“æ›´æ–°æˆåŠŸ"
}
```

### 4. è·å–ç»Ÿè®¡ä¿¡æ¯æ¥å£

**æ¥å£ï¼š`GET /api/stats`**

**å“åº”æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "total": 170,
    "byType": {
      "0": 50,
      "1": 30,
      "2": 40,
      "3": 30,
      "4": 20
    },
    "lastUpdate": "2025-11-28T18:30:00"
  }
}
```

---

## ä¸‰ã€å‰ç«¯ï¼ˆæ²¹çŒ´è„šæœ¬ï¼‰å®ç°

### 1. é¢˜ç›®æå–åŠŸèƒ½

**ä»é¡µé¢æå–é¢˜ç›®ä¿¡æ¯ï¼š**
```javascript
function extractQuestionFromPage(questionElement) {
    // æå–é¢˜ç›®ID
    const questionId = questionElement.dataset.questionId || 
                       questionElement.querySelector('[data-question-id]')?.dataset.questionId;
    
    // æå–é¢˜ç›®å†…å®¹
    const questionContent = questionElement.querySelector('.question-content')?.textContent.trim();
    
    // æå–é¢˜ç›®ç±»å‹
    const type = questionElement.dataset.type || detectQuestionType(questionElement);
    
    // æå–é€‰é¡¹ï¼ˆå¦‚æœæ˜¯é€‰æ‹©é¢˜ï¼‰
    const options = [];
    if (type === '0' || type === '1') {
        const optionElements = questionElement.querySelectorAll('.question-option-item');
        optionElements.forEach(opt => {
            options.push(opt.textContent.trim());
        });
    }
    
    return {
        questionId,
        questionContent,
        type,
        options
    };
}
```

### 2. æœç´¢ç­”æ¡ˆåŠŸèƒ½

```javascript
async function searchAnswer(questionData) {
    try {
        const response = await fetch('http://localhost:8000/api/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(questionData)
        });
        
        const result = await response.json();
        
        if (result.success && result.data) {
            return result.data.answer;
        }
        
        return null;
    } catch (error) {
        console.error('æœç´¢ç­”æ¡ˆå¤±è´¥:', error);
        return null;
    }
}
```

### 3. ä¸Šä¼ é¢˜åº“åŠŸèƒ½

```javascript
async function uploadQuestionBank(data, res, answerRecords) {
    try {
        const response = await fetch('http://localhost:8000/api/upload', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                data: data,
                res: res,
                answerRecords: answerRecords
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('é¢˜åº“ä¸Šä¼ æˆåŠŸ:', result.data);
            return true;
        }
        
        return false;
    } catch (error) {
        console.error('ä¸Šä¼ é¢˜åº“å¤±è´¥:', error);
        return false;
    }
}
```

### 4. ä½¿ç”¨GM_xmlhttpRequestï¼ˆæ²¹çŒ´ä¸“ç”¨ï¼‰

```javascript
function searchAnswerWithGM(questionData) {
    return new Promise((resolve, reject) => {
        GM_xmlhttpRequest({
            method: 'POST',
            url: 'http://localhost:8000/api/search',
            headers: {
                'Content-Type': 'application/json',
            },
            data: JSON.stringify(questionData),
            onload: function(response) {
                try {
                    const result = JSON.parse(response.responseText);
                    if (result.success && result.data) {
                        resolve(result.data.answer);
                    } else {
                        resolve(null);
                    }
                } catch (e) {
                    reject(e);
                }
            },
            onerror: function(error) {
                reject(error);
            }
        });
    });
}
```

---

## å››ã€åç«¯å®ç°è¦ç‚¹

### 1. é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ main.py              # FastAPIä¸»æ–‡ä»¶
â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”œâ”€â”€ database.py          # æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ search.py            # æœç´¢é€»è¾‘ï¼ˆå¤ç”¨search_answer.pyï¼‰
â”œâ”€â”€ update.py            # æ›´æ–°é€»è¾‘ï¼ˆå¤ç”¨update_answer_bank.pyï¼‰
â”œâ”€â”€ answer_bank.db       # SQLiteæ•°æ®åº“
â”œâ”€â”€ answer.json          # JSONå¤‡ä»½
â””â”€â”€ requirements.txt     # ä¾èµ–
```

### 2. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**æ•°æ®åº“æ¨¡å‹ï¼š**
- é¢˜ç›®è¡¨ï¼šid, questionId, type, questionContent, answer, solution, options, timestamp
- ç´¢å¼•ï¼šquestionId, questionContentï¼ˆå…¨æ–‡æœç´¢ï¼‰

**æœç´¢ç­–ç•¥ï¼š**
1. ä¼˜å…ˆæŒ‰questionIdç²¾ç¡®åŒ¹é…
2. å…¶æ¬¡æŒ‰questionContentæ¨¡ç³ŠåŒ¹é…ï¼ˆç›¸ä¼¼åº¦ç®—æ³•ï¼‰
3. æ”¯æŒé€‰é¡¹åŒ¹é…ï¼ˆé€‰æ‹©é¢˜ï¼‰

**æ›´æ–°ç­–ç•¥ï¼š**
1. æ¥æ”¶ä¸Šä¼ çš„é¢˜åº“æ•°æ®
2. è°ƒç”¨update_answer_bank.pyçš„é€»è¾‘
3. æ›´æ–°æ•°æ®åº“å’ŒJSONæ–‡ä»¶
4. è¿”å›ç»Ÿè®¡ä¿¡æ¯

---

## äº”ã€å®‰å…¨è€ƒè™‘

### 1. APIè®¤è¯ï¼ˆå¯é€‰ï¼‰

**ç®€å•æ–¹æ¡ˆï¼šAPI Key**
```python
API_KEY = "your-secret-api-key"

@app.middleware("http")
async def verify_api_key(request: Request, call_next):
    if request.url.path.startswith("/api/"):
        api_key = request.headers.get("X-API-Key")
        if api_key != API_KEY:
            return JSONResponse({"success": False, "message": "Invalid API Key"}, status_code=401)
    return await call_next(request)
```

### 2. è¯·æ±‚é™åˆ¶

```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter

@app.post("/api/search")
@limiter.limit("100/minute")  # æ¯åˆ†é’Ÿ100æ¬¡è¯·æ±‚
async def search(request: Request, ...):
    ...
```

### 3. æ•°æ®éªŒè¯

ä½¿ç”¨Pydanticæ¨¡å‹éªŒè¯è¾“å…¥ï¼š
```python
from pydantic import BaseModel, Field

class SearchRequest(BaseModel):
    questionId: Optional[str] = None
    questionContent: str = Field(..., min_length=1, max_length=5000)
    type: str = Field(..., regex="^[0-4]$")
    options: Optional[List[str]] = None
```

---

## å…­ã€åŠŸèƒ½æ¸…å•

### åç«¯åŠŸèƒ½
- [x] æœç´¢ç­”æ¡ˆï¼ˆå•ä¸ªé¢˜ç›®ï¼‰
- [x] æ‰¹é‡æœç´¢ç­”æ¡ˆ
- [x] ä¸Šä¼ é¢˜åº“æ›´æ–°
- [x] è·å–ç»Ÿè®¡ä¿¡æ¯
- [ ] APIè®¤è¯ï¼ˆå¯é€‰ï¼‰
- [ ] è¯·æ±‚é¢‘ç‡é™åˆ¶
- [ ] æ•°æ®å¤‡ä»½å’Œæ¢å¤
- [ ] æ—¥å¿—è®°å½•

### å‰ç«¯åŠŸèƒ½
- [x] ä»é¡µé¢æå–é¢˜ç›®ä¿¡æ¯
- [x] è°ƒç”¨åç«¯APIæœç´¢ç­”æ¡ˆ
- [x] è‡ªåŠ¨å¡«å†™ç­”æ¡ˆ
- [x] ä¸Šä¼ ç­”é¢˜ç»“æœåˆ°åç«¯
- [ ] é…ç½®åç«¯APIåœ°å€
- [ ] æ˜¾ç¤ºæœç´¢çŠ¶æ€å’Œç»“æœ
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

---

## ä¸ƒã€éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
# å®‰è£…ä¾èµ–
pip install fastapi uvicorn python-multipart

# è¿è¡ŒæœåŠ¡
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨Gunicorn
pip install gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

### Dockeréƒ¨ç½²ï¼ˆå¯é€‰ï¼‰
```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["gunicorn", "main:app", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "--bind", "0.0.0.0:8000"]
```

---

## å…«ã€åç»­ä¼˜åŒ–æ–¹å‘

1. **ç¼“å­˜æœºåˆ¶**ï¼šä½¿ç”¨Redisç¼“å­˜çƒ­é—¨é¢˜ç›®ç­”æ¡ˆ
2. **ç›¸ä¼¼åº¦ç®—æ³•**ï¼šä½¿ç”¨æ–‡æœ¬ç›¸ä¼¼åº¦ç®—æ³•ï¼ˆå¦‚TF-IDFã€ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰æé«˜åŒ¹é…å‡†ç¡®ç‡
3. **å¼‚æ­¥å¤„ç†**ï¼šæ‰¹é‡ä¸Šä¼ æ—¶ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
4. **ç›‘æ§å’Œæ—¥å¿—**ï¼šæ·»åŠ æ—¥å¿—ç³»ç»Ÿå’Œæ€§èƒ½ç›‘æ§
5. **Webç•Œé¢**ï¼šæä¾›ç®€å•çš„Webç®¡ç†ç•Œé¢æŸ¥çœ‹ç»Ÿè®¡å’Œæ‰‹åŠ¨ç®¡ç†é¢˜åº“

---

## ä¹ã€å¤šå¹³å°æ”¯æŒæ¶æ„è®¾è®¡

### 1. å¹³å°é€‚é…å™¨æ¨¡å¼

**è®¾è®¡æ€è·¯**ï¼šä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œæ¯ä¸ªå¹³å°å®ç°ç»Ÿä¸€çš„æ¥å£ï¼Œä¾¿äºæ‰©å±•æ–°å¹³å°ã€‚

**å¹³å°åˆ—è¡¨**ï¼š
- âœ… **ä¼ æ™ºæ’­å®¢** (czbk) - `https://stu.ityxb.com/*`
- ğŸ”œ **è¶…æ˜Ÿå­¦ä¹ é€š** (chaoxing) - `https://*.chaoxing.com/*`
- ğŸ”œ **å…¶ä»–å¹³å°** - å¯æ‰©å±•

### 2. å‰ç«¯æ¶æ„ï¼ˆæ²¹çŒ´è„šæœ¬ï¼‰

**é¡¹ç›®ç»“æ„ï¼š**
```
userscript/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ platform-adapter.js      # å¹³å°é€‚é…å™¨åŸºç±»
â”‚   â”œâ”€â”€ question-extractor.js    # é¢˜ç›®æå–å™¨ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
â”‚   â”œâ”€â”€ answer-filler.js          # ç­”æ¡ˆå¡«å†™å™¨ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
â”‚   â””â”€â”€ api-client.js             # APIå®¢æˆ·ç«¯
â”œâ”€â”€ platforms/
â”‚   â”œâ”€â”€ czbk.js                   # ä¼ æ™ºæ’­å®¢é€‚é…å™¨
â”‚   â”œâ”€â”€ chaoxing.js               # è¶…æ˜Ÿå­¦ä¹ é€šé€‚é…å™¨ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ base.js                   # å¹³å°åŸºç±»
â”œâ”€â”€ config.js                     # é…ç½®æ–‡ä»¶
â””â”€â”€ main.js                       # ä¸»å…¥å£
```

**å¹³å°é€‚é…å™¨æ¥å£ï¼š**
```javascript
class PlatformAdapter {
    // å¹³å°æ ‡è¯†
    getPlatformId() { return 'unknown'; }
    
    // å¹³å°åç§°
    getPlatformName() { return 'æœªçŸ¥å¹³å°'; }
    
    // æ£€æµ‹æ˜¯å¦åŒ¹é…å½“å‰é¡µé¢
    matchPage() { return false; }
    
    // æå–é¢˜ç›®ä¿¡æ¯
    extractQuestion(questionElement) { return null; }
    
    // æå–æ‰€æœ‰é¢˜ç›®
    extractAllQuestions() { return []; }
    
    // å¡«å†™ç­”æ¡ˆ
    fillAnswer(questionElement, answer) { return false; }
    
    // æ£€æµ‹é¢˜ç›®ç±»å‹
    detectQuestionType(questionElement) { return '0'; }
    
    // è·å–é¢˜ç›®ID
    getQuestionId(questionElement) { return null; }
    
    // è·å–é¢˜ç›®å†…å®¹
    getQuestionContent(questionElement) { return ''; }
    
    // è·å–é€‰é¡¹åˆ—è¡¨
    getOptions(questionElement) { return []; }
}
```

**ä¼ æ™ºæ’­å®¢é€‚é…å™¨ç¤ºä¾‹ï¼š**
```javascript
class CzbkAdapter extends PlatformAdapter {
    getPlatformId() { return 'czbk'; }
    getPlatformName() { return 'ä¼ æ™ºæ’­å®¢'; }
    
    matchPage() {
        return window.location.hostname.includes('ityxb.com');
    }
    
    extractQuestion(questionElement) {
        const questionId = questionElement.dataset.questionId || 
                          questionElement.querySelector('[data-question-id]')?.dataset.questionId;
        
        const questionContent = questionElement.querySelector('.question-content')?.textContent.trim();
        
        const type = this.detectQuestionType(questionElement);
        
        const options = [];
        if (type === '0' || type === '1') {
            const optionElements = questionElement.querySelectorAll('.question-option-item');
            optionElements.forEach(opt => {
                options.push(opt.textContent.trim());
            });
        }
        
        return {
            questionId,
            questionContent,
            type,
            options,
            platform: this.getPlatformId()
        };
    }
    
    fillAnswer(questionElement, answer) {
        const type = this.detectQuestionType(questionElement);
        
        if (type === '0') {  // å•é€‰é¢˜
            const radio = questionElement.querySelector(`input[type="radio"][value="${answer}"]`);
            if (radio) {
                radio.click();
                return true;
            }
        } else if (type === '1') {  // å¤šé€‰é¢˜
            const answers = answer.split(',').map(a => a.trim());
            answers.forEach(ans => {
                const checkbox = questionElement.querySelector(`input[type="checkbox"][value="${ans}"]`);
                if (checkbox) checkbox.click();
            });
            return true;
        } else if (type === '2') {  // åˆ¤æ–­é¢˜
            const isCorrect = answer === 'å¯¹' || answer === 'æ­£ç¡®';
            const radio = questionElement.querySelector(`input[type="radio"][value="${isCorrect ? '1' : '0'}"]`);
            if (radio) {
                radio.click();
                return true;
            }
        }
        // ... å…¶ä»–ç±»å‹
        
        return false;
    }
    
    detectQuestionType(questionElement) {
        // ä¼ æ™ºæ’­å®¢çš„é¢˜ç›®ç±»å‹æ£€æµ‹é€»è¾‘
        if (questionElement.querySelector('input[type="radio"]')) return '0';
        if (questionElement.querySelector('input[type="checkbox"]')) return '1';
        if (questionElement.classList.contains('judgment-question')) return '2';
        if (questionElement.querySelector('input[type="text"]')) return '3';
        return '0';  // é»˜è®¤å•é€‰
    }
}
```

**å¹³å°ç®¡ç†å™¨ï¼š**
```javascript
class PlatformManager {
    constructor() {
        this.adapters = [];
        this.currentAdapter = null;
    }
    
    // æ³¨å†Œå¹³å°é€‚é…å™¨
    registerAdapter(adapter) {
        this.adapters.push(adapter);
    }
    
    // æ£€æµ‹å¹¶é€‰æ‹©å½“å‰å¹³å°
    detectPlatform() {
        for (const adapter of this.adapters) {
            if (adapter.matchPage()) {
                this.currentAdapter = adapter;
                console.log(`æ£€æµ‹åˆ°å¹³å°: ${adapter.getPlatformName()}`);
                return adapter;
            }
        }
        console.warn('æœªæ£€æµ‹åˆ°æ”¯æŒçš„å¹³å°');
        return null;
    }
    
    // è·å–å½“å‰å¹³å°é€‚é…å™¨
    getCurrentAdapter() {
        if (!this.currentAdapter) {
            this.detectPlatform();
        }
        return this.currentAdapter;
    }
}
```

### 3. åç«¯å¤šå¹³å°æ”¯æŒ

**æ•°æ®åº“è®¾è®¡ï¼š**
```sql
-- é¢˜ç›®è¡¨ï¼ˆå¢åŠ platformå­—æ®µï¼‰
CREATE TABLE questions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    question_id TEXT NOT NULL,
    platform TEXT NOT NULL,  -- å¹³å°æ ‡è¯†ï¼šczbk, chaoxingç­‰
    type TEXT NOT NULL,
    question_content TEXT NOT NULL,
    answer TEXT,
    solution TEXT,
    options TEXT,  -- JSONæ ¼å¼å­˜å‚¨é€‰é¡¹
    timestamp INTEGER,
    UNIQUE(question_id, platform)  -- åŒä¸€é¢˜ç›®åœ¨ä¸åŒå¹³å°å¯èƒ½æœ‰ä¸åŒID
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_platform ON questions(platform);
CREATE INDEX idx_question_id ON questions(question_id);
CREATE INDEX idx_content ON questions(question_content);
```

**APIå¢å¼ºï¼š**
```python
# æœç´¢æ¥å£å¢åŠ platformå‚æ•°
class SearchRequest(BaseModel):
    questionId: Optional[str] = None
    questionContent: str
    type: str
    options: Optional[List[str]] = None
    platform: Optional[str] = None  # å¹³å°æ ‡è¯†ï¼Œå¯é€‰

@app.post("/api/search")
async def search(request: SearchRequest):
    # å¦‚æœæŒ‡å®šäº†å¹³å°ï¼Œä¼˜å…ˆåœ¨è¯¥å¹³å°æœç´¢
    if request.platform:
        results = search_in_platform(request.platform, request)
    else:
        # åœ¨æ‰€æœ‰å¹³å°æœç´¢
        results = search_all_platforms(request)
    return results
```

**å¹³å°é…ç½®ç®¡ç†ï¼š**
```python
# platforms/config.py
PLATFORMS = {
    'czbk': {
        'name': 'ä¼ æ™ºæ’­å®¢',
        'domains': ['stu.ityxb.com', 'ityxb.com'],
        'enabled': True,
        'answer_format': {
            '0': 'single_letter',  # å•é€‰é¢˜ï¼šå•ä¸ªå­—æ¯
            '1': 'comma_separated',  # å¤šé€‰é¢˜ï¼šé€—å·åˆ†éš”
            '2': 'judgment',  # åˆ¤æ–­é¢˜ï¼šå¯¹/é”™
        }
    },
    'chaoxing': {
        'name': 'è¶…æ˜Ÿå­¦ä¹ é€š',
        'domains': ['chaoxing.com'],
        'enabled': False,  # å¾…å¼€å‘
        'answer_format': {
            '0': 'single_letter',
            '1': 'comma_separated',
            '2': 'judgment',
        }
    }
}
```

### 4. å¹³å°è¯†åˆ«æœºåˆ¶

**å‰ç«¯è‡ªåŠ¨è¯†åˆ«ï¼š**
```javascript
// ä¸»å…¥å£
(function() {
    'use strict';
    
    const platformManager = new PlatformManager();
    
    // æ³¨å†Œæ‰€æœ‰å¹³å°é€‚é…å™¨
    platformManager.registerAdapter(new CzbkAdapter());
    // platformManager.registerAdapter(new ChaoxingAdapter());  // å¾…å®ç°
    
    // æ£€æµ‹å¹³å°
    const adapter = platformManager.detectPlatform();
    if (!adapter) {
        console.warn('å½“å‰é¡µé¢ä¸æ”¯æŒè‡ªåŠ¨ç­”é¢˜');
        return;
    }
    
    // åˆå§‹åŒ–ç­”é¢˜ç³»ç»Ÿ
    const answerSystem = new AnswerSystem(adapter, platformManager);
    answerSystem.init();
})();
```

**åç«¯å¹³å°è¯†åˆ«ï¼š**
```python
def detect_platform_from_request(request: SearchRequest) -> Optional[str]:
    """ä»è¯·æ±‚ä¸­è¯†åˆ«å¹³å°"""
    # æ–¹æ³•1: ä»platformå­—æ®µè¯†åˆ«
    if request.platform:
        return request.platform
    
    # æ–¹æ³•2: ä»é¢˜ç›®æ ¼å¼ç‰¹å¾è¯†åˆ«
    # ä¼ æ™ºæ’­å®¢çš„é¢˜ç›®IDæ ¼å¼ã€é€‰é¡¹æ ¼å¼ç­‰ç‰¹å¾
    if request.questionId and len(request.questionId) == 32:
        # å¯èƒ½æ˜¯ä¼ æ™ºæ’­å®¢çš„UUIDæ ¼å¼
        return 'czbk'
    
    # æ–¹æ³•3: ä»é¢˜ç›®å†…å®¹ç‰¹å¾è¯†åˆ«
    # ä¸åŒå¹³å°çš„é¢˜ç›®å¯èƒ½æœ‰ä¸åŒçš„ç‰¹å¾æ ‡è®°
    
    return None
```

### 5. é…ç½®ç®¡ç†

**å‰ç«¯é…ç½®ï¼š**
```javascript
// config.js
const config = {
    // APIé…ç½®
    api: {
        baseUrl: 'http://localhost:8000',
        timeout: 5000,
        retryTimes: 3
    },
    
    // å¹³å°é…ç½®
    platforms: {
        czbk: {
            enabled: true,
            autoAnswer: true,
            selectors: {
                question: '.question-item',
                questionContent: '.question-content',
                options: '.question-option-item',
                radio: 'input[type="radio"]',
                checkbox: 'input[type="checkbox"]'
            }
        },
        chaoxing: {
            enabled: false,  // å¾…å¼€å‘
            autoAnswer: false,
            selectors: {
                // è¶…æ˜Ÿå­¦ä¹ é€šçš„é€‰æ‹©å™¨ï¼ˆå¾…å®ç°ï¼‰
            }
        }
    }
};
```

### 6. æ‰©å±•æ–°å¹³å°çš„æ­¥éª¤

**æ·»åŠ æ–°å¹³å°åªéœ€3æ­¥ï¼š**

1. **åˆ›å»ºå¹³å°é€‚é…å™¨ç±»**
```javascript
// platforms/chaoxing.js
class ChaoxingAdapter extends PlatformAdapter {
    getPlatformId() { return 'chaoxing'; }
    getPlatformName() { return 'è¶…æ˜Ÿå­¦ä¹ é€š'; }
    
    matchPage() {
        return window.location.hostname.includes('chaoxing.com');
    }
    
    extractQuestion(questionElement) {
        // å®ç°è¶…æ˜Ÿå­¦ä¹ é€šçš„é¢˜ç›®æå–é€»è¾‘
    }
    
    fillAnswer(questionElement, answer) {
        // å®ç°è¶…æ˜Ÿå­¦ä¹ é€šçš„ç­”æ¡ˆå¡«å†™é€»è¾‘
    }
}
```

2. **æ³¨å†Œé€‚é…å™¨**
```javascript
platformManager.registerAdapter(new ChaoxingAdapter());
```

3. **åç«¯é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰**
```python
PLATFORMS['chaoxing'] = {
    'name': 'è¶…æ˜Ÿå­¦ä¹ é€š',
    'domains': ['chaoxing.com'],
    'enabled': True,
    # ... é…ç½®
}
```

---

## åã€è®¨è®ºè¦ç‚¹

### éœ€è¦ç¡®è®¤çš„é—®é¢˜ï¼š

1. **APIåœ°å€é…ç½®**ï¼šåç«¯æ˜¯æœ¬åœ°è¿è¡Œè¿˜æ˜¯éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Ÿ
2. **è®¤è¯æ–¹å¼**ï¼šæ˜¯å¦éœ€è¦API Keyè®¤è¯ï¼Ÿ
3. **æ•°æ®å­˜å‚¨**ï¼šä½¿ç”¨SQLiteè¿˜æ˜¯å…¶ä»–æ•°æ®åº“ï¼Ÿ
4. **ç›¸ä¼¼åº¦åŒ¹é…**ï¼šæ˜¯å¦éœ€è¦å®ç°é¢˜ç›®å†…å®¹ç›¸ä¼¼åº¦åŒ¹é…ï¼ˆå¤„ç†é¢˜ç›®æ–‡å­—ç•¥æœ‰å·®å¼‚çš„æƒ…å†µï¼‰ï¼Ÿ
5. **æ‰¹é‡ä¸Šä¼ **ï¼šæ˜¯å¦éœ€è¦æ”¯æŒå¢é‡æ›´æ–°ï¼ˆåªä¸Šä¼ æ–°å¢çš„é¢˜ç›®ï¼‰ï¼Ÿ
6. **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œé”™è¯¯æ—¶çš„é‡è¯•ç­–ç•¥ï¼Ÿ
7. **å¹³å°éš”ç¦»**ï¼šä¸åŒå¹³å°çš„ç­”æ¡ˆåº“æ˜¯å¦éœ€è¦éš”ç¦»ï¼Ÿè¿˜æ˜¯å…±äº«ï¼Ÿ
8. **å¹³å°ä¼˜å…ˆçº§**ï¼šå¦‚æœåŒä¸€é¢˜ç›®åœ¨å¤šä¸ªå¹³å°éƒ½æœ‰ï¼Œæœç´¢æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ

### å»ºè®®çš„å®ç°é¡ºåºï¼š

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šä¼ æ™ºæ’­å®¢å¹³å°å®Œæ•´å®ç°
   - åŸºç¡€APIï¼ˆæœç´¢ã€ä¸Šä¼ ï¼‰
   - ä¼ æ™ºæ’­å®¢é€‚é…å™¨
   - å‰ç«¯é›†æˆ

2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå¤šå¹³å°æ¶æ„æ­å»º
   - å¹³å°é€‚é…å™¨æ¡†æ¶
   - å¹³å°ç®¡ç†å™¨
   - é…ç½®ç³»ç»Ÿ

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæ‰©å±•è¶…æ˜Ÿå­¦ä¹ é€š
   - è¶…æ˜Ÿå­¦ä¹ é€šé€‚é…å™¨
   - æµ‹è¯•å’Œä¼˜åŒ–

4. **ç¬¬å››é˜¶æ®µ**ï¼šä¼˜åŒ–å’Œå¢å¼º
   - ç›¸ä¼¼åº¦åŒ¹é…
   - ç¼“å­˜æœºåˆ¶
   - è®¤è¯å’Œé™æµ

